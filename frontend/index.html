<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscador de Vehículos</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
</head>
<body>
  <h1>Buscador de Vehículos</h1>

  <!-- Formulario de búsqueda -->
  <form id="searchForm">
    <label for="plateNumber">Placa:</label>
    <input type="text" id="plateNumber" name="plateNumber">

    <label for="startDate">Inicio:</label>
    <input type="datetime-local" id="startDate" name="startDate" required>

    <label for="endDate">Fin:</label>
    <input type="datetime-local" id="endDate" name="endDate" required>

    <button type="submit">Buscar</button>
  </form>
 
<!-- Modal -->
<div id="imageModal" class="modal">
  <span class="close" onclick="document.getElementById('imageModal').style.display='none'">&times;</span>
  <img class="modal-content" id="modalImage" />
</div>

  <div id="map"></div>

  <!-- Contenedor para la tabla de resultados -->
  <button id="loadPOIsButton">Restaura puntos</button>
  <div id="resultsTable"></div>

  <script>
    // Verificar si el token existe en localStorage
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('token');

      if (!token) {
        // Si no hay token, redirige al login
        window.location.href = 'login.html';
      } else {
        // Si el token existe, verifica su validez (opcional)
        // Esto se puede hacer en el backend o en el frontend
        validateToken(token);
      }
    });

    // Función para validar el token
    async function validateToken(token) {
      try {
        const response = await fetch('/api/validate-token', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json',
          }
        });

        const data = await response.json();

        if (data.isValid) {
          // El token es válido, continuar con la carga de la página
          console.log('Token válido');
        } else {
          // Si el token no es válido, redirigir al login
          localStorage.removeItem('token');
          window.location.href = 'login.html';
        }
      } catch (error) {
        console.error('Error al verificar el token', error);
        localStorage.removeItem('token');
        window.location.href = 'login.html';  // Redirigir si hay un error
      }
    }
  </script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="app.js"></script>
</body>
</html>